<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exemplo de Heatmap - SPTECH Store</title>
    <script src="https://unpkg.com/heatmap.js"></script> <!-- Importar a biblioteca heatmap.js -->
    <link rel="stylesheet" href="../css/dashboards.css">
    <link rel="icon" href="../assets/icon/logo.ico" />
    <link rel="stylesheet" href="../css/style.css">
</head>
<style>
    .dash_body {
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        margin: 0;
        min-height: 100vh;
    }

    main {
        width: 100%;
        margin-left: 17vw;
        justify-self: flex-end;
        align-content: center;
        display: flex;
        flex-direction: column;

        input {
            font-size: large;
        }
    }
</style>

<body class="dash_body">
    <aside>
        <a href="../index.html"><img src="../assets/imgs/SMFlogoFull.png" alt=""></a>
        <h2>Seja bem vindo, Brandão!</h2>
        <li>
            <ul><a class="aside_buttons" href="./dashboard.html">
                    <p>Graficos Gerais</p>
                </a></ul>
            <ul><a class="aside_buttons" href="./sensorindividual.html">
                    <p>Sensores Individuais</p>
                </a></ul>
            <ul style="background-color: #045064; color: #08a4bd;"><a class="aside_buttons" href="">
                    <p>Mapa de calor dos setores</p>
                </a></ul>
            <ul><a class="aside_buttons" href="./gerenciar.html">
                    <p>Gerencie sua Conta</p>
                </a></ul>
            <ul><a class="aside_buttons" href="../index.html">
                    <p>Voltar para Tela inicial</p>
                </a></ul>
            <ul class="bt_vermelho"><a class="aside_buttons" href="../login.html">
                    <p>Sair da conta</p>
                </a></ul>
        </li>

    </aside>

    <main>
        <h1 class="titulo_dash">Fluxo de Clientes</h1>

        <div class="cardsD">
            <div class="cardD">
                <h2 id="kpi-totalClientes"></h2>
                <p>Total de Clientes (1h)</p>
            </div>
            <div class="cardD">
                <h2 id="kpi-menosMovimentado"></h2>
                <p>Mais Movimentado</p>
            </div>
            <div class="cardD">
                <h2 id="kpi-maisMovimentado"></h2>
                <p>Menos Movimentado</p>
            </div>
        </div>
        <div class="controles">
            <div>
                <h3>Intervalo de Tempo</h3>
                <br>
                <p>Selecione um intervalo de tempo para visualizar os dados:</p>
                <br>
            </div>
            <div class="dataDiv">
                <label for="data-inicial">Data Inicial:</label>
                <input type="date" id="data-inicial" name="data-inicial" value="2024-01-01">
                <label for="data-final">Data Final:</label>
                <input type="date" id="data-final" name="data-final" value="2024-10-01">
            </div>
            <div class="horaDiv">
                <div class="horas">
                    <label for="hora1">Hora inicial do intervalo:</label>
                    <br><br>
                    <select id="hora1" name="hora1">
                        <option value="00:00">00:00</option>
                        <option value="01:00">01:00</option>
                        <option value="02:00">02:00</option>
                        <option value="03:00">03:00</option>
                        <option value="04:00">04:00</option>
                        <option value="05:00">05:00</option>
                        <option value="06:00">06:00</option>
                        <option value="07:00">07:00</option>
                        <option value="08:00">08:00</option>
                        <option value="09:00">09:00</option>
                        <option value="10:00">10:00</option>
                        <option value="11:00">11:00</option>
                        <option value="12:00">12:00</option>
                        <option value="13:00">13:00</option>
                        <option value="14:00">14:00</option>
                        <option value="15:00">15:00</option>
                        <option value="16:00">16:00</option>
                        <option value="17:00">17:00</option>
                        <option value="18:00">18:00</option>
                        <option value="19:00">19:00</option>
                        <option value="20:00">20:00</option>
                        <option value="21:00">21:00</option>
                        <option value="22:00">22:00</option>
                        <option value="23:00">23:00</option>
                    </select>
                </div>
                <div class="horas">
                    <label for="hora2">Hora final do intervalo:</label>
                    <br><br>
                    <select id="hora2" name="hora2">
                        <option value="00:00">00:00</option>
                        <option value="01:00">01:00</option>
                        <option value="02:00">02:00</option>
                        <option value="03:00">03:00</option>
                        <option value="04:00">04:00</option>
                        <option value="05:00">05:00</option>
                        <option value="06:00">06:00</option>
                        <option value="07:00">07:00</option>
                        <option value="08:00">08:00</option>
                        <option value="09:00">09:00</option>
                        <option value="10:00">10:00</option>
                        <option value="11:00">11:00</option>
                        <option value="12:00">12:00</option>
                        <option value="13:00">13:00</option>
                        <option value="14:00">14:00</option>
                        <option value="15:00">15:00</option>
                        <option value="16:00">16:00</option>
                        <option value="17:00">17:00</option>
                        <option value="18:00">18:00</option>
                        <option value="19:00">19:00</option>
                        <option value="20:00">20:00</option>
                        <option value="21:00">21:00</option>
                        <option value="22:00">22:00</option>
                        <option value="23:00">23:00</option>
                    </select>
                </div>
            </div>

            <button onclick="filtrarDadosPorDataHora()">Aplicar Intervalo de Tempo</button>
        </div>

        <!-- Div para exibir o heatmap -->
        <div class="arduinoAlocacao"></div>
        <div class="heatmap"></div>
    </main>
</body>
<script>
    // Criar uma instância do heatmap.js
    var instanciaHeatmap = h337.create({
        container: document.querySelector('.heatmap')
    });

    function buscarDadosSensor() {



    }
    // Estrutura de dados separada por locais, cada local tem várias capturas de dados com datas e horários
    var dadosPorLocal = {

        local1: [
            { x: 25, y: 175, value: 30, radius: 130 },
            { x: 95, y: 175, value: 40, radius: 130 },
            { x: 95, y: 175, value: 50, radius: 130 }
        ],
        local2: [
            { x: 310, y: 225, value: 20, radius: 90 },
            { x: 310, y: 225, value: 30, radius: 90 },
            { x: 310, y: 225, value: 40, radius: 90 }
        ],
        local3: [
            { x: 545, y: 190, value: 60, radius: 100 },
            { x: 545, y: 190, value: 70, radius: 100 },
            { x: 545, y: 190, value: 80, radius: 100 }
        ],
        local4: [
            { x: 190, y: 364, value: 50, radius: 130 },
            { x: 190, y: 364, value: 60, radius: 130 },
            { x: 190, y: 364, value: 70, radius: 130 }
        ],
        local5: [
            { x: 400, y: 365, value: 80, radius: 130 },
            { x: 400, y: 365, value: 40, radius: 130 },
            { x: 400, y: 365, value: 50, radius: 130 }
        ],
        local6: [
            { x: 700, y: 265, value: 80, radius: 130 },
            { x: 700, y: 265, value: 40, radius: 130 },
            { x: 700, y: 265, value: 50, radius: 130 }
        ],
        local7: [
            { x: 700, y: 265, value: 80, radius: 130 },
            { x: 700, y: 265, value: 40, radius: 130 },
            { x: 700, y: 265, value: 50, radius: 130 }
        ],
        local8: [
            { x: 700, y: 265, value: 80, radius: 130 },
            { x: 700, y: 265, value: 40, radius: 130 },
            { x: 700, y: 265, value: 50, radius: 130 }
        ],
        local9: [
            { x: 700, y: 265, value: 80, radius: 130 },
            { x: 700, y: 265, value: 40, radius: 130 },
            { x: 700, y: 265, value: 50, radius: 130 }
        ]
    };

    // Função para aplicar o filtro de intervalo de data e hora e adicionar os dados ao heatmap
    function filtrarDadosPorDataHora() {
        var horaInicioIntervalo = document.getElementById('hora1').value;
        var horaFinalIntervalo = document.getElementById('hora2').value;
        var dataInicial = document.getElementById('data-inicial').value;
        var dataFinal = document.getElementById('data-final').value;
        console.log(dataFinal);


        // Converter os dados e horários em objetos Date

        if (horaFinalIntervalo < horaInicioIntervalo) {
            alert("A data e hora final devem ser maiores ou iguais à data e hora inicial.");
            return;
        } else {

            fetch("/heatMap/buscarIntervalo", {
                headers: { "Content-Type": "application/json" },
                
            }).then(function (resposta) {
                if (resposta.ok) {
                    console.log("Busca realizada com sucesso")

                    resposta.json().then(json => {
                        console.log(json);
                        console.log(JSON.stringify(json));


                    });

                } else {
                    console.log("Houve um erro ao trazer a resposta da busca");
                    console.log(resposta);
                }

            }).catch(function (erro) {
                console.log(erro);
            })

            // Limpar o heatmap antes de adicionar novos dados
            // instanciaHeatmap.setData({ max: 0, data: [] });

            // Percorrer todos os locais
            // for (var local in dadosPorLocal) {
            //     var dadosDoLocal = dadosPorLocal[local];

            //     // Percorrer cada ponto de dados dentro de um local
            //     // for (var i = 0; i < dadosDoLocal.length; i++) {
            //     //     var ponto = dadosDoLocal[i];
            //     //     var dataHoraPonto = new Date(ponto.dataHora);

            //     //     // Verificar se o ponto de dados está dentro do intervalo de data e hora
            //     //     if (dataHoraPonto >= dataHoraInicial && dataHoraPonto <= dataHoraFinal) {
            //     //         // Usando addData para adicionar os pontos ao heatmap
            //     //         instanciaHeatmap.addData(ponto);
            //     //     }
            //     // }
            // }
        }
    }

    filtrarDadosPorDataHora();
</script>

</body>

</html>